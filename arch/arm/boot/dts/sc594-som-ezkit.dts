/*
 * Device tree for ADI sc594-som-ezkit board
 *
 * Copyright 2014 - 2020 Analog Devices Inc.
 *
 * Licensed under the GPL-2 or later.
 *
 */

/dts-v1/;

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/net/ti-dp83867.h>
#include "sc59x.dtsi"

/ {
	model = "ADI sc594-som-ezkit";
	compatible = "adi,sc594-som-ezkit", "adi,sc59x";

	aliases {
	};

	memory@C3000000 {
		device_type = "memory";
		reg = <0xC3000000 0xF000000>;
	};

	scb {
		softconfig_default {
			boot-pins = <&ssw0 0 GPIO_ACTIVE_LOW>,	 /* LED */
			            <&ssw0 1 GPIO_ACTIVE_LOW>,	 /* LED */
			            <&ssw0 2 GPIO_ACTIVE_LOW>,	 /* LED */
			            <&ssw0 3 GPIO_ACTIVE_HIGH>,	 /* SPI2FLASH_CS */
			            <&ssw0 4 GPIO_ACTIVE_LOW>,	 /* SPI2D2_D3_EN */
			            <&ssw0 5 GPIO_ACTIVE_LOW>,	 /* UART0_EN */
			            <&ssw0 6 GPIO_ACTIVE_LOW>,	 /* UART0_FLOW_EN */
			            <&ssw0 7 GPIO_ACTIVE_HIGH>,	 /* OSPIFLASH_CS */
			            <&ssw1 0 GPIO_ACTIVE_LOW>,	 /* EEPROM_EN */
			            <&ssw1 1 GPIO_ACTIVE_HIGH>,	 /* PB_EN */
			            <&ssw1 2 GPIO_ACTIVE_LOW>,	 /* MICROSD_SPI */
			            <&ssw1 5 GPIO_ACTIVE_LOW>,	 /* ADAU_RESET */
			            <&ssw1 6 GPIO_ACTIVE_HIGH>,	 /* ADAU1962_EN */
			            <&ssw1 7 GPIO_ACTIVE_HIGH>,	 /* ADAU1979_EN */
			            <&ssw1 8 GPIO_ACTIVE_LOW>,	 /* OCTAL_SPI_CS_EN */
			            <&ssw1 9 GPIO_ACTIVE_LOW>,	 /* SPDIF_DIGITAL_EN */
			            <&ssw1 10 GPIO_ACTIVE_LOW>,	 /* SPDIF_OPTICAL_EN */
			            <&ssw1 11 GPIO_ACTIVE_LOW>,	 /* AUDIO_JACK_SEL */
			            <&ssw1 12 GPIO_ACTIVE_LOW>,	 /* MLB_EN */
			            <&ssw1 13 GPIO_ACTIVE_HIGH>, /* ETH1_EN */
			            <&ssw1 14 GPIO_ACTIVE_LOW>,  /* ETH1_RESET */
			            <&ssw1 15 GPIO_ACTIVE_LOW>;  /* GIGE_RESET */

			reboot-pins = <&ssw0 3 GPIO_ACTIVE_LOW>,	/* SP2IFLASH_CS */
			              <&ssw0 4 GPIO_ACTIVE_LOW>;	/* SPI2D2_D3_EN */
		};

/* The button GPIO conflicts with OSPI0_D4 for this
		button0: button@0 {
			compatible = "adi,button-led";
			en-pins = <&ssw1 1 GPIO_ACTIVE_LOW>;	/* PUSHBUTTON_EN
			button_gpio = <48>; /* PD_00
			led_gpio = <35>; /* PC_03 / LED9 / LED1_KIT
		};
*/

/* This also appears to interfere with the OSPI somehow...
   possible trace noise/interference?
		button1: button@1 {
			compatible = "adi,button-led";
			en-pins = <&ssw1 1 GPIO_ACTIVE_HIGH>; /* PUSHBUTTON_EN
			button_gpio = <112>; /* PH_00
			led_gpio = <34>; /* PC_02 / LED8 / LED2_KIT
		};
*/

		core1-rproc@0x3108c000 {
			compatible = "adi,remoteproc";
			reg = <0x3108c000 0x70>;
			core-id = <1>;
			core-irq = <74>; /* was 77 */
			firmware-name = "adi_adsp_core1_fw.ldr";
		};

		core2-rproc@0x3108c000 {
			compatible = "adi,remoteproc";
			reg = <0x3108c000 0x70>;
			core-id = <2>;
			core-irq = <75>; /* was 78 */
			firmware-name = "adi_adsp_core2_fw.ldr";
		};

		sound {
			compatible = "sc5xx,asoc-card";
			adi,cpu-dai = <&i2s0>;
			adi,codec = <&adau1962>, <&adau1979>;
		};

		lcd@0 {
			compatible = "sc58x,lcd";
			reg = <0x31040000 0xFF>;
			interrupts = <GIC_SPI 83 IRQ_TYPE_LEVEL_HIGH>;
			dma-channel = <28>;
			cs-gpio = <39>;
			spu_securep_id = <95>;
			pinctrl-names = "default", "ppi_16b", "ppi_24b";
			pinctrl-0 = <&ppi0_8b>;
			pinctrl-1 = <&ppi0_16b>;
			pinctrl-2 = <&ppi0_24b>;
		};
	};
};

&uart0 {
	enable-pin = <&ssw0 5 GPIO_ACTIVE_LOW>;	/* UART0_EN */
	hwflow-en-pin = <&ssw0 6 GPIO_ACTIVE_LOW>; /* UART0_FLOW_EN */
	pinctrl-names = "default", "hwflow";
	pinctrl-0 = <&uart0_default>;
	pinctrl-1 = <&uart0_hwflow>;
	status = "okay";
};

&rtc0 {
	status = "disabled";
};

&spi0 {
	pinctrl-names = "default";
	pinctrl-0 = <&spi0_default>;
	status = "disabled";

	spidev {
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "rohm,dh2228fv";
		spi-max-frequency = <5000000>;
		reg = <44>;
	};

	ad7879_touchscreen {
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "adi,ad7879";
		spi-max-frequency = <5000000>;
		reg = <32>;
		gpio = <88>;
		gpio-controller;
		spi-cpha;
		spi-cpol;
		touchscreen-max-pressure = <10000>;
		adi,resistance-plate-x = <620>;
		adi,first-conversion-delay = /bits/ 8 <3>;
		adi,acquisition-time = /bits/ 8 <1>;
		adi,median-filter-size = /bits/ 8 <2>;
		adi,averaging = /bits/ 8 <1>;
		adi,conversion-interval = /bits/ 8 <255>;
	};
};

&spi1 {
	pinctrl-names = "default";
	pinctrl-0 = <&spi1_default>;
	status = "okay";

	spidev@13{
		compatible = "rohm,dh2228fv";
		spi-max-frequency = <5000000>;
		reg = <13>;
	};
};

&spi2 {
	pinctrl-names = "default";
	pinctrl-0 = <&spi2_quad>;
	status = "okay";


/* mx66lm1g45 and is25lp512 are mutually exclusive */

/*
	flash: mx66lm1g45@0 {
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "mx66lm1g45", "jedec,spi-nor";
		spi-max-frequency = <5000000>;
		reg = <5>;
		spi-cpol;
		spi-cpha;
		spi-rx-bus-width = <4>;

		partition@0 {
			label = "unallocated (mx66)";
			reg = <0x0 0x2000000>;
		};

	};
*/

	flash: is25lp512@0 {
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "is25lp512", "jedec,spi-nor";
		spi-max-frequency = <5000000>;
		reg = <5>;
		spi-cpol;
		spi-cpha;
		spi-rx-bus-width = <4>;

		partition@0 {
			label = "unallocated (is25lp512)";
			reg = <0x0 0x2000000>;
		};

	};

};

&ospi {
	pinctrl-names = "default";
	pinctrl-0 = <&ospi_default>;

	status = "okay";

	flash0: is25lx256@0 {
		#address-cells = <1>;
		#size-cells = <1>;
		compatible = "is25lx256";
		reg = <0>;
		spi-max-frequency = <112000000>;

		/*m25p,fast-read;*/

		cdns,page-size = <256>;
		cdns,block-size = <16>;
		cdns,read-delay = <4>;
		cdns,tshsl-ns = <50>;
		cdns,tsd2d-ns = <50>;
		cdns,tchsh-ns = <4>;
		cdns,tslch-ns = <4>;

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			ospi_0: partition@0 {
				label = "U-Boot";
				reg = <0x0 0x80000>;
			};

			ospi_1: partition@1 {
				label = "U-Boot Environment";
				reg = <0x80000 0x20000>;
			};

			ospi_2: partition@2 {
				label = "Device Tree Blob";
				reg = <0xA0000 0x20000>;
			};

			ospi_3: partition@3 {
				label = "Kernel zImage";
				reg = <0xC0000 0x600000>;
			};

			ospi_4: partition@4 {
				label = "JFFS2 Formatted RFS";
				reg = <0x6C0000 0x1940000>;
			};
		};
	};
};

&i2c0 {
	status = "disabled";
};

&i2c1 {
	status = "disabled";
};

&i2c2 {
	status = "okay";

	ssw0: gpio@0x21 {
		compatible = "microchip,mcp23017";
		gpio-controller;
		#gpio-cells = <2>;
		reg = <0x21>;
	};

	ssw1: gpio@0x22 {
		compatible = "microchip,mcp23017";
		gpio-controller;
		#gpio-cells = <2>;
		reg = <0x22>;
	};

	adau1979: adau1979@0x11 {
		compatible = "adi,adau1977";
		reg = <0x11>;
		enable-pin = <&ssw1 7 GPIO_ACTIVE_LOW>; /* ADAU1979_EN */
		/* reset-gpio = <&ssw1 5 GPIO_ACTIVE_LOW>;  ADAU_RESET */
	};

	adau1962: adau1962@0x4 {
		compatible = "adi,adau1962";
		reg = <0x4>;
		enable-pin = <&ssw1 6 GPIO_ACTIVE_LOW>; /* ADAU1962_EN */
		/* reset-gpio = <&ssw1 5 GPIO_ACTIVE_LOW>;  ADAU_RESET */
	};
};

&i2s0 {
	reg = <0x31002400 0x80>, <0x31002480 0x80>;
	interrupts = <GIC_SPI 98 IRQ_TYPE_LEVEL_HIGH>,
			<GIC_SPI 100 IRQ_TYPE_LEVEL_HIGH>,
			<GIC_SPI 165 IRQ_TYPE_EDGE_RISING>
			;
	dma-channel = <10>, <11>;
	status = "okay";
};

&crc0 {
	status = "disabled";
};

&crc1 {
	status = "disabled";
};

&can0 {
	/* enable-pin = <&ssw0 ? GPIO_ACTIVE_LOW>; CAN0_EN */
	pinctrl-names = "default";
	pinctrl-0 = <&can0_default>;
	phy-name = "tja1055";
	phy-gpios = <&gpb 8 0>,		/* en PB8 */
		    <&gpb 2 0x1>;	/* stb PB2, GPIO_ACTIVE_LOW */
	status = "disabled";
};

&can1 {
	/* enable-pin = <&ssw0 ? GPIO_ACTIVE_LOW>; CAN1_EN */
	pinctrl-names = "default";
	pinctrl-0 = <&can1_default>;
	phy-name = "tja1145";
	phy-spibus = /bits/ 16 <0>;
	phy-spiclk = <1000000>;
	phy-spics = /bits/ 16 <44>;	/* GPIO_PC12 */
	status = "disabled";
};

&emac0 {
	snps,reset-active-low;
	snps,reset-delays-us = <0 200 500>;
	phy-handle = <&dp83867>;
	phy-mode = "rgmii-id";
	pinctrl-names = "default";
	pinctrl-0 = <&eth0_default>;
	status = "okay";
	mdio0 {
		compatible = "snps,dwmac-mdio";
		#address-cells = <1>;
		#size-cells = <0>;
		dp83867: ethernet-phy@0 {
			reg = <0>;
			ti,rx-internal-delay = <DP83867_RGMIIDCTL_2_00_NS>;
			ti,tx-internal-delay = <DP83867_RGMIIDCTL_2_00_NS>;
			ti,fifo-depth = <DP83867_PHYCR_FIFO_DEPTH_8_B_NIB>;
			ti,dp83867-rxctrl-strap-quirk;
		};
	};
};

&emac1 {
	phy-mode = "rmii";
	pinctrl-names = "default";
	pinctrl-0 = <&eth1_default>;
	status = "okay";
};

&usb0_phy {
	status = "okay";
};

&usb0 {
	mode = <3>; /* OTG port */
	status = "disabled";
};

&usb1_phy {
	status = "disabled";
};

&usb1 {
	mode = <2>; /* Device port */
	status = "disabled";
};

&mmc0 {
	/* wp-en-pin = <&ssw0 ? GPIO_ACTIVE_LOW>;	 SD_WP_EN */
	bus-width = <4>;
	pinctrl-names = "default";
	pinctrl-0 = <&mmc0_8bgrp>;
	supports-highspeed;
	status = "disabled";
};

&icc0 {
	status = "okay";
};

&video_decoder {
	pinctrl-names = "8bit", "16bit", "24bit";
	pinctrl-0 = <&ppi0_8b>;
	pinctrl-1 = <&ppi0_16b>;
	pinctrl-2 = <&ppi0_24b>;
	status = "disabled";
};

&video_encoder {
	pinctrl-names = "8bit", "16bit", "24bit";
	pinctrl-0 = <&ppi0_8b>;
	pinctrl-1 = <&ppi0_16b>;
	pinctrl-2 = <&ppi0_24b>;
	status = "disabled";
};

&lp0 {
	pinctrl-names = "default";
	pinctrl-0 = <&lp0_default>;
	status = "okay";
};

&lp1 {
	pinctrl-names = "default";
	pinctrl-0 = <&lp1_default>;
	status = "okay";
};

&sram_mmap {
	status = "disabled";
};
